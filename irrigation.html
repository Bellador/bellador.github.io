<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soil Moisture Measurement</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            text-align: center;
        }

        h1 {
            color: #333;
        }

        .moisture-value {
            font-size: 24px;
            margin: 20px 0;
        }

        .traffic-light {
            width: 100px;
            height: 100px;
            display: inline-block;
            margin-top: 20px;
            border-radius: 50%; /* Make it a circle */
        }

        .soil-condition-text {
            font-size: 18px;
            font-weight: bold;
            margin-top: 10px;
        }

        .chart-container {
            width: 80%;
            margin: 20px auto;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        function updateMoistureColor() {
            var moistureValue = parseFloat('2.634');
            var color = 'black'; // Default color
            var soilConditionText = 'Unknown';

            if (!isNaN(moistureValue)) {
                if (moistureValue >= 1.8) {
                    color = 'green'; // Green for high moisture
                    soilConditionText = 'Green: Sufficiently Watered';
                } else if (moistureValue >= 1.3) {
                    color = 'orange'; // Orange for moderate moisture
                    soilConditionText = 'Orange: Consider Watering';
                } else {
                    color = 'red'; // Red for low moisture
                    soilConditionText = 'Red: Needs Urgent Water';
                    
                }
            }

            var moistureElement = document.querySelector('.moisture-value');
            moistureElement.style.color = color;

            var trafficLightElement = document.querySelector('.traffic-light');
            trafficLightElement.style.backgroundColor = color;

            var soilConditionTextElement = document.querySelector('.soil-condition-text');
            soilConditionTextElement.innerText = soilConditionText;
        }

        function createLineChart(data) {
            var ctx = document.getElementById('lineChart').getContext('2d');
            var myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.time,
                    datasets: [{
                        label: 'Soil Moisture',
                        data: data.moisture,
                        borderColor: 'brown',
                        borderWidth: 2,
                        fill: false
                    },
                    {
                        label: 'Irrigation Events',
                        data: data.irrigationEvents.map(function(timestamp) {
                            return 0;  // y-value for the bar chart
                        }),
                        backgroundColor: 'blue',
                        borderColor: 'rgba(0, 0, 255, 0.4)',
                        borderWidth: 20,  // Adjust the line width as needed
                        fill: false
                    }]
                },
                options: {
                    plugins: {
                        filler: {
                            propagate: false
                        }
                    },
                    scales: {
                        x: {
                            title: {
                              display: true,
                              text: 'Time of Measurement'
                            }
                        },
                        y: {
                            title: {
                                  display: true,
                                  text: 'Relative Moisture'
                                }
                            }
                    }
                }
            });

            // Add two horizontal lines and color the area below 1.3 red, between 1.3 and 1.8 orange, and above 1.8 green
            // Add two horizontal lines and color the area below 1.3 red, between 1.3 and 1.8 orange, and above 1.8 green
            myChart.data.datasets.push({
                borderColor: 'transparent',  // Hide the line
                data: Array(data.time.length).fill(1.3),
                borderWidth: 0,
                pointRadius: 0,
                fill: 'start',
                backgroundColor: 'rgba(255, 0, 0, 0.4)',  // Transparent red
                label: 'Danger',  // Add an empty label to hide the legend item
            });

            myChart.data.datasets.push({
                borderColor: 'transparent',  // Hide the line
                data: Array(data.time.length).fill(1.8),
                borderWidth: 0,
                pointRadius: 0,
                fill: '-1',
                backgroundColor: 'rgba(255, 165, 0, 0.4)',  // Transparent orange
                label: 'Caution',  // Add an empty label to hide the legend item
            });

            myChart.data.datasets.push({
                borderColor: 'transparent',  // Hide the line
                data: Array(data.time.length).fill(3),
                borderWidth: 0,
                pointRadius: 0,
                fill: 'start',
                backgroundColor: 'rgba(0, 128, 0, 0.4)',  // Transparent green
                label: 'Good',  // Add an empty label to hide the legend item
            });

            myChart.update();

        }


        var Data = {
            time: ['2023-09-17 12:51:30', '2023-09-17 12:55:30', '2023-09-17 13:01:49', '2023-09-17 13:11:54', '2023-09-17 13:21:59', '2023-09-17 13:32:04', '2023-09-17 13:42:09', '2023-09-17 13:52:15', '2023-09-17 14:02:20', '2023-09-17 14:12:25', '2023-09-17 14:22:30', '2023-09-17 14:32:35', '2023-09-17 14:42:40', '2023-09-17 14:52:45', '2023-09-17 15:02:50', '2023-09-17 15:12:55', '2023-09-17 15:23:01', '2023-09-17 15:33:06', '2023-09-17 15:43:11', '2023-09-17 15:53:16', '2023-09-17 16:03:21', '2023-09-17 16:13:26', '2023-09-17 16:23:31', '2023-09-17 16:33:36', '2023-09-17 16:43:41', '2023-09-17 16:53:47', '2023-09-17 17:03:52', '2023-09-17 17:13:57', '2023-09-17 17:24:02', '2023-09-17 17:34:07', '2023-09-17 17:44:12', '2023-09-17 17:54:17', '2023-09-17 18:04:22', '2023-09-17 18:14:27', '2023-09-17 18:24:32', '2023-09-17 18:34:38', '2023-09-17 18:44:43', '2023-09-17 18:54:48', '2023-09-17 19:04:53', '2023-09-17 19:14:58', '2023-09-17 19:25:03', '2023-09-17 19:35:08', '2023-09-17 19:45:13', '2023-09-17 19:55:19', '2023-09-17 20:05:24', '2023-09-17 20:15:29', '2023-09-17 20:25:34', '2023-09-17 20:35:39', '2023-09-17 20:45:44', '2023-09-17 20:55:49', '2023-09-17 21:05:54', '2023-09-17 21:15:59', '2023-09-17 21:26:04', '2023-09-17 21:36:10', '2023-09-17 21:46:15', '2023-09-17 21:56:20', '2023-09-17 22:06:25', '2023-09-17 22:16:30', '2023-09-17 22:26:35', '2023-09-17 22:36:40', '2023-09-17 22:46:45', '2023-09-17 22:56:50', '2023-09-17 23:06:56', '2023-09-17 23:17:01', '2023-09-17 23:27:06', '2023-09-17 23:37:11', '2023-09-17 23:47:16', '2023-09-17 23:57:21', '2023-09-18 00:07:26', '2023-09-18 00:17:31', '2023-09-18 00:27:36', '2023-09-18 00:37:42', '2023-09-18 00:47:47', '2023-09-18 00:57:52', '2023-09-18 01:07:57', '2023-09-18 01:18:02', '2023-09-18 01:28:07', '2023-09-18 01:38:12', '2023-09-18 01:48:17', '2023-09-18 01:58:22', '2023-09-18 02:08:28', '2023-09-18 02:18:33', '2023-09-18 02:28:38', '2023-09-18 02:38:43', '2023-09-18 02:48:48', '2023-09-18 02:58:53', '2023-09-18 03:08:58', '2023-09-18 03:19:03', '2023-09-18 03:29:08', '2023-09-18 03:39:13', '2023-09-18 03:49:19', '2023-09-18 03:59:24', '2023-09-18 04:09:29', '2023-09-18 04:19:34', '2023-09-18 04:29:39', '2023-09-18 04:39:44', '2023-09-18 04:49:49', '2023-09-18 04:59:54', '2023-09-18 05:09:59', '2023-09-18 05:20:04', '2023-09-18 05:30:10', '2023-09-18 05:40:15', '2023-09-18 05:50:20', '2023-09-18 06:00:25', '2023-09-18 06:10:30', '2023-09-18 06:20:35', '2023-09-18 06:30:40', '2023-09-18 06:40:45', '2023-09-18 06:50:51', '2023-09-18 07:00:56', '2023-09-18 07:11:01', '2023-09-18 07:21:06', '2023-09-18 07:31:11', '2023-09-18 07:41:16', '2023-09-18 07:51:21', '2023-09-18 08:01:26', '2023-09-18 08:11:31', '2023-09-18 08:21:37', '2023-09-18 08:31:42', '2023-09-18 08:41:47', '2023-09-18 08:51:52', '2023-09-18 09:01:57', '2023-09-18 09:12:02', '2023-09-18 09:22:07', '2023-09-18 09:32:12', '2023-09-18 09:42:18', '2023-09-18 09:52:23', '2023-09-18 10:02:28', '2023-09-18 10:12:33', '2023-09-18 10:22:38', '2023-09-18 10:32:43', '2023-09-18 10:42:48', '2023-09-18 10:52:53', '2023-09-18 11:02:58', '2023-09-18 11:13:03', '2023-09-18 11:23:09', '2023-09-18 11:33:14', '2023-09-18 11:43:19', '2023-09-18 11:53:24', '2023-09-18 12:03:29', '2023-09-18 12:13:34', '2023-09-18 12:23:39', '2023-09-18 12:33:44', '2023-09-18 12:43:49', '2023-09-18 12:53:55', '2023-09-18 13:04:00', '2023-09-18 13:14:05', '2023-09-18 13:24:10', '2023-09-18 13:34:15', '2023-09-18 13:44:20', '2023-09-18 13:54:25', '2023-09-18 14:04:30', '2023-09-18 14:14:36', '2023-09-18 14:24:41', '2023-09-18 14:34:46', '2023-09-18 14:44:51', '2023-09-18 14:54:56', '2023-09-18 15:05:01', '2023-09-18 15:15:06', '2023-09-18 15:25:11', '2023-09-18 15:35:16', '2023-09-18 15:45:22', '2023-09-18 15:55:27', '2023-09-18 16:05:32', '2023-09-18 16:15:37', '2023-09-18 16:25:42', '2023-09-18 16:35:47', '2023-09-18 16:45:52', '2023-09-18 16:55:57', '2023-09-18 17:06:03', '2023-09-18 17:16:08', '2023-09-18 17:26:13', '2023-09-18 17:36:18', '2023-09-18 17:46:23', '2023-09-18 17:56:28', '2023-09-18 18:06:33', '2023-09-18 18:16:38', '2023-09-18 18:26:43', '2023-09-18 18:36:49', '2023-09-18 18:46:54', '2023-09-18 18:56:59', '2023-09-18 19:07:04', '2023-09-18 19:17:09', '2023-09-18 19:27:14', '2023-09-18 19:37:19', '2023-09-18 19:47:24', '2023-09-18 19:57:29', '2023-09-18 20:07:35', '2023-09-18 20:17:40', '2023-09-18 20:27:45', '2023-09-18 20:37:50', '2023-09-18 20:47:55', '2023-09-18 20:58:00', '2023-09-18 21:08:05', '2023-09-18 21:18:10', '2023-09-18 21:28:15', '2023-09-18 21:38:21', '2023-09-18 21:48:26', '2023-09-18 21:58:31', '2023-09-18 22:08:36', '2023-09-18 22:18:41', '2023-09-18 22:28:46', '2023-09-18 22:38:51', '2023-09-18 22:48:56', '2023-09-18 22:59:01'],
            moisture: [2.465, 2.779, 2.332, 2.277, 2.239, 2.219, 2.198, 2.191, 2.178, 2.144, 2.133, 2.114, 2.105, 2.0749999999999997, 2.0469999999999997, 2.025, 1.983, 1.944, 1.907, 1.879, 1.8409999999999997, 1.8249999999999997, 1.8239999999999998, 1.8049999999999997, 1.806, 1.8329999999999997, 1.8329999999999997, 1.8479999999999999, 1.8409999999999997, 1.8439999999999999, 1.8329999999999997, 1.8329999999999997, 2.735, 2.62, 2.516, 2.457, 2.435, 2.421, 2.397, 2.388, 2.38, 2.384, 2.379, 2.37, 2.375, 2.37, 2.359, 2.356, 2.3569999999999998, 2.3569999999999998, 2.3579999999999997, 2.3499999999999996, 2.354, 2.3449999999999998, 2.3489999999999998, 2.339, 2.3489999999999998, 2.342, 2.334, 2.331, 2.338, 2.3369999999999997, 2.338, 2.344, 2.341, 2.346, 2.339, 2.348, 2.348, 2.3489999999999998, 2.348, 2.351, 2.348, 2.355, 2.352, 2.3529999999999998, 2.36, 2.364, 2.367, 2.363, 2.372, 2.371, 2.377, 2.37, 2.3819999999999997, 2.3819999999999997, 2.389, 2.384, 2.394, 2.393, 2.392, 2.399, 2.404, 2.412, 2.407, 2.4139999999999997, 2.427, 2.432, 2.424, 2.4339999999999997, 2.441, 2.44, 2.457, 2.464, 2.464, 2.465, 2.465, 2.4699999999999998, 2.46, 2.464, 2.468, 2.473, 2.469, 2.463, 2.473, 2.472, 2.472, 2.479, 2.477, 2.48, 2.593, 2.735, 2.706, 2.679, 2.69, 2.699, 2.75, 2.8249999999999997, 2.802, 2.788, 2.7649999999999997, 2.7889999999999997, 2.856, 2.832, 2.8, 2.774, 2.758, 2.754, 2.75, 2.756, 2.755, 2.7729999999999997, 2.806, 2.7849999999999997, 2.777, 2.7489999999999997, 2.739, 2.734, 2.7199999999999998, 2.7119999999999997, 2.709, 2.69, 2.6879999999999997, 2.684, 2.682, 2.6719999999999997, 2.663, 2.668, 2.66, 2.658, 2.654, 2.654, 2.647, 2.639, 2.634, 2.635, 2.634, 2.626, 2.633, 2.636, 2.6319999999999997, 2.634, 2.625, 2.625, 2.629, 2.627, 2.626, 2.636, 2.6319999999999997, 2.636, 2.63, 2.625, 2.633, 2.63, 2.627, 2.633, 2.627, 2.627, 2.627, 2.628, 2.634, 2.63, 2.637, 2.636, 2.627, 2.637, 2.628, 2.628, 2.628, 2.637, 2.633, 2.636, 2.626, 2.639, 2.634],
            irrigationEvents: ['2023-09-17 12:55:30']
        };

        // Call the functions when the page loads
        window.onload = function () {
            updateMoistureColor();
            createLineChart(Data);
        };
    </script>
</head>
<body>
    <h1>Latest Soil Moisture Measurement</h1>
    <p class="moisture-value">Moisture Value: 2.634</p>
    <p>Time of Measurement: 2023-09-18 22:59:01</p>
    <div class="traffic-light"></div>
    <div class="soil-condition-text">Soil Condition: Unknown</div>
    <div class="chart-container">
        <canvas id="lineChart"></canvas>
    </div>
</body>
</html>